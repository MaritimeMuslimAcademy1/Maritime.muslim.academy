<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Account Settings</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: rgba(10,15,30,0.9);
  font-size: 14px;
}

.top-bar .title { font-weight: bold; font-size: 18px; }
.top-bar .back-btn {
  background: #007bff22;
  border: 1px solid #007bff44;
  color: #fff;
  padding: 6px 14px;
  border-radius: 8px;
  cursor: pointer;
}

.content {
  max-width: 500px;
  margin: 40px auto;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.avatar-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.avatar-container img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #007bff44;
}

input[type="file"] {
  color: #fff;
}

input, button {
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #222;
  color: #fff;
  font-size: 16px;
  width: 100%;
}

button {
  background: #007bff22;
  border: 1px solid #007bff44;
  cursor: pointer;
}

#saveMessage {
  font-size: 14px;
  color: #0f0;
}
</style>
</head>
<body>

<div class="top-bar">
  <div class="title">Account Settings</div>
  <button class="back-btn" onclick="goBack()">‚Üê Back</button>
</div>

<div class="content">
  <div class="avatar-container">
    <img id="avatarPreview" src="https://scontent-lga3-3.xx.fbcdn.net/v/t39.30808-6/597164807_1335245238401700_1090041719849665448_n.jpg" alt="Avatar">
    <input type="file" id="avatarInput" accept="image/*">
  </div>

  <input type="text" id="firstName" placeholder="First Name">
  <input type="text" id="lastName" placeholder="Last Name">
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">

  <button onclick="saveSettings()">Save Settings</button>
  <p id="saveMessage"></p>
</div>

<script>
function goBack() {
  window.location.href = "dashboard.html";
}

// Load saved data
const savedData = JSON.parse(localStorage.getItem("accountData")) || {};
document.getElementById("firstName").value = savedData.firstName || "";
document.getElementById("lastName").value = savedData.lastName || "";
document.getElementById("username").value = savedData.username || localStorage.getItem("username");
document.getElementById("password").value = savedData.password || "";
if(savedData.avatar) {
  document.getElementById("avatarPreview").src = savedData.avatar;
}

// Avatar preview and live dashboard update
document.getElementById("avatarInput").addEventListener("change", function() {
  const file = this.files[0];
  if(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("avatarPreview").src = e.target.result;
      localStorage.setItem("avatar", e.target.result);
      updateDashboardAvatar(e.target.result);
    }
    reader.readAsDataURL(file);
  }
});

// Save settings with 14-day cooldown for username and password
function saveSettings() {
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const avatar = document.getElementById("avatarPreview").src;

  const now = new Date().getTime();
  const lastChange = savedData.lastChange || 0;

  if(now - lastChange < 14*24*60*60*1000) {
    document.getElementById("saveMessage").textContent = "Username and password can be changed once every 14 days.";
    return;
  }

  const accountData = { firstName, lastName, username, password, avatar, lastChange: now };
  localStorage.setItem("accountData", JSON.stringify(accountData));
  localStorage.setItem("username", username);
  localStorage.setItem("password", password);
  localStorage.setItem("avatar", avatar);

  updateDashboardUsername(username);
  updateDashboardAvatar(avatar);

  document.getElementById("saveMessage").textContent = "Settings saved successfully!";
}

// Functions to update dashboard directly
function updateDashboardAvatar(src) {
  localStorage.setItem("dashboardAvatar", src);
}

function updateDashboardUsername(name) {
  localStorage.setItem("dashboardUsername", name);
}
</script>

</body>
</html>
