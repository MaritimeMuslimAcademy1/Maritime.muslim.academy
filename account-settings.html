<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Account Settings</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #000;
  color: #fff;
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: rgba(10,15,30,0.9);
  padding: 10px 20px;
  width: 100%;
  font-size: 14px;
}

.top-bar .center { font-weight: bold; font-size: 18px; }

.content {
  margin-top: 100px;
  width: 90%;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.content label {
  font-size: 14px;
  margin-bottom: 5px;
}

.content input[type="text"],
.content input[type="password"],
.content input[type="file"] {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background-color: #222;
  color: #fff;
  font-size: 16px;
}

.content button {
  padding: 12px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(to right, #0066cc, #0099ff);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  font-size: 16px;
  margin-top: 10px;
}

.avatar-preview {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background-color: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  margin-bottom: 10px;
}

.avatar-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
</style>
</head>
<body>

<div class="top-bar">
  <div class="left" onclick="goBack()">‚Üê Back</div>
  <div class="center">Account Settings</div>
</div>

<div class="content">
  <div class="avatar-preview" id="avatarPreview">
    <img src="https://scontent-lga3-3.xx.fbcdn.net/v/t39.30808-6/597164807_1335245238401700_1090041719849665448_n.jpg" alt="Avatar">
  </div>
  <label>Upload Avatar</label>
  <input type="file" id="avatarInput" accept="image/*">

  <label>First Name</label>
  <input type="text" id="firstName">

  <label>Last Name</label>
  <input type="text" id="lastName">

  <label>Username</label>
  <input type="text" id="username">

  <label>Password</label>
  <input type="password" id="password">

  <button onclick="saveChanges()">Save Changes</button>
  <p id="message"></p>
</div>

<script>
// Load saved data
const usernameKey = "username";
const roleKey = "role";
const firstNameKey = "firstName";
const lastNameKey = "lastName";
const passwordKey = "password";
const avatarKey = "avatar";
const usernameDateKey = "usernameDate";
const passwordDateKey = "passwordDate";

const currentUsername = localStorage.getItem(usernameKey);
const role = localStorage.getItem(roleKey);

document.getElementById("username").value = currentUsername || "";
document.getElementById("firstName").value = localStorage.getItem(firstNameKey) || "";
document.getElementById("lastName").value = localStorage.getItem(lastNameKey) || "";
document.getElementById("password").value = localStorage.getItem(passwordKey) || "";

const savedAvatar = localStorage.getItem(avatarKey);
if(savedAvatar){
  document.querySelector("#avatarPreview img").src = savedAvatar;
}

// Avatar preview
document.getElementById("avatarInput").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(event){
      document.querySelector("#avatarPreview img").src = event.target.result;
    }
    reader.readAsDataURL(file);
  }
});

function saveChanges(){
  const newFirst = document.getElementById("firstName").value.trim();
  const newLast = document.getElementById("lastName").value.trim();
  const newUsername = document.getElementById("username").value.trim();
  const newPassword = document.getElementById("password").value.trim();
  const message = document.getElementById("message");
  const now = new Date().getTime();

  // Check username change 14 days
  const lastUsernameChange = localStorage.getItem(usernameDateKey);
  if(lastUsernameChange && now - lastUsernameChange < 14*24*60*60*1000 && newUsername !== currentUsername){
    message.style.color = "red";
    message.textContent = "Username can be changed only once every 14 days.";
    return;
  }

  // Check password change 14 days
  const lastPasswordChange = localStorage.getItem(passwordDateKey);
  if(lastPasswordChange && now - lastPasswordChange < 14*24*60*60*1000 && newPassword !== localStorage.getItem(passwordKey)){
    message.style.color = "red";
    message.textContent = "Password can be changed only once every 14 days.";
    return;
  }

  // Save changes
  localStorage.setItem(firstNameKey, newFirst);
  localStorage.setItem(lastNameKey, newLast);

  if(newUsername !== currentUsername){
    localStorage.setItem(usernameKey, newUsername);
    localStorage.setItem(usernameDateKey, now);
  }

  if(newPassword !== localStorage.getItem(passwordKey)){
    localStorage.setItem(passwordKey, newPassword);
    localStorage.setItem(passwordDateKey, now);
  }

  // Avatar
  const avatarSrc = document.querySelector("#avatarPreview img").src;
  localStorage.setItem(avatarKey, avatarSrc);

  message.style.color = "green";
  message.textContent = "Changes saved successfully!";
}

// Back button
function goBack(){
  window.location.href = "dashboard.html";
}
</script>

</body>
</html>
