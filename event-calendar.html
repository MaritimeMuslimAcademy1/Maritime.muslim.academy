<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event & Calendar</title>
<style>
body {
  margin: 0;
  font-family: Arial,sans-serif;
  background: #000;
  color: #fff;
  height: 100vh;
  display: flex;
  flex-direction: column;
}
.top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background: rgba(10,15,30,0.9);
  padding:10px 20px;
  font-size:14px;
}
.top-bar .center { font-weight:bold; font-size:18px; }
.top-bar .right button {
  background:#007bff22;
  border:1px solid #007bff44;
  color:#fff;
  padding:6px 14px;
  border-radius:8px;
  cursor:pointer;
}
.content { margin:120px auto 60px; width:900px; }
.calendar {
  background:#0d1b2a;
  border:1px solid #007bff44;
  border-radius:16px;
  padding:20px;
}
.calendar-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.calendar-header button {
  background:#007bff22;
  border:1px solid #007bff44;
  color:#fff;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
}
.calendar-header .month { font-size:18px; font-weight:bold; }
.weekdays {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  text-align:center;
  opacity:0.7;
  margin-bottom:10px;
}
.days {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
}
.day {
  min-height:90px;
  background: rgba(255,255,255,0.03);
  border-radius:10px;
  padding:5px;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  justify-content:center; /* center events vertically */
  align-items:center;
}
.day.today { border:1px solid #007bff; }
.day .date { font-size:13px; opacity:0.8; margin-bottom:4px; }
.event {
  background: rgba(0,123,255,0.2);
  border-radius:6px;
  padding:2px 4px;
  font-size:12px;
  margin:2px 0;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:2px;
}
.event button {
  background:transparent;
  border:none;
  color:#fff;
  font-size:10px;
  cursor:pointer;
}
.empty-state {
  text-align:center;
  opacity:0.6;
  margin-top:30px;
}
</style>
</head>
<body>

<div class="top-bar">
  <div class="center">Event & Calendar</div>
  <div class="right">
    <button onclick="goBack()">‚Üê Back</button>
  </div>
</div>

<div class="content">
  <div class="calendar">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚Äπ</button>
      <div class="month" id="monthLabel"></div>
      <button onclick="changeMonth(1)">‚Ä∫</button>
    </div>
    <div class="weekdays">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="days" id="calendarDays"></div>
    <div class="empty-state" id="emptyState">No events scheduled</div>
  </div>
</div>

<script>
const role = localStorage.getItem("role") || "guest";
const isAdmin = role === "admin";
let currentDate = new Date();

// Load events from localStorage
let events = JSON.parse(localStorage.getItem("events") || "{}");

function goBack(){ window.location.href='dashboard.html'; }

function saveEvents(){ localStorage.setItem("events", JSON.stringify(events)); }

function renderCalendar(){
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  document.getElementById("monthLabel").textContent = monthNames[month]+" "+year;

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1,0).getDate();
  const calendarDays = document.getElementById("calendarDays");
  calendarDays.innerHTML="";

  for(let i=0;i<firstDay;i++){
    const empty=document.createElement("div");
    empty.className="day empty";
    calendarDays.appendChild(empty);
  }

  let hasEvents=false;

  for(let d=1; d<=daysInMonth; d++){
    const day=document.createElement("div");
    day.className="day";
    const today=new Date();
    if(d===today.getDate() && month===today.getMonth() && year===today.getFullYear()){
      day.classList.add("today");
    }

    const dateKey=`${year}-${month+1}-${d}`;
    if(!events[dateKey]) events[dateKey]=[];

    day.innerHTML=`<div class="date">${d}</div>`;

    events[dateKey].forEach((ev,i)=>{
      const evDiv=document.createElement("div");
      evDiv.className="event";
      evDiv.innerHTML=`<span>${ev}</span>`;
      if(isAdmin){
        const editBtn=document.createElement("button");
        editBtn.textContent="‚úé";
        editBtn.onclick=()=>editEvent(dateKey,i);
        const delBtn=document.createElement("button");
        delBtn.textContent="üóë";
        delBtn.onclick=()=>deleteEvent(dateKey,i);
        evDiv.appendChild(editBtn);
        evDiv.appendChild(delBtn);
      }
      day.appendChild(evDiv);
    });

    if(events[dateKey].length>0) hasEvents=true;
    if(isAdmin) day.onclick=()=>addEvent(dateKey);

    calendarDays.appendChild(day);
  }

  document.getElementById("emptyState").style.display = hasEvents?"none":"block";
}

function changeMonth(step){ currentDate.setMonth(currentDate.getMonth()+step); renderCalendar(); }

function addEvent(dateKey){
  const ev=prompt("Enter event:");
  if(ev){
    events[dateKey].push(ev);
    saveEvents();
    renderCalendar();
  }
}

function editEvent(dateKey,index){
  const ev=prompt("Edit event:", events[dateKey][index]);
  if(ev){
    events[dateKey][index]=ev;
    saveEvents();
    renderCalendar();
  }
}

function deleteEvent(dateKey,index){
  if(confirm("Delete this event?")){
    events[dateKey].splice(index,1);
    saveEvents();
    renderCalendar();
  }
}

renderCalendar();
</script>
</body>
</html>
