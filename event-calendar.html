<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event & Calendar</title>
<style>
body {
  margin: 0;
  font-family: Arial,sans-serif;
  background: #000;
  color: #fff;
  height: 100vh;
  display: flex;
  flex-direction: column;
}
.top-bar {
  display:flex; justify-content:space-between; align-items:center;
  background: rgba(10,15,30,0.9); padding:10px 20px; font-size:14px;
}
.top-bar .center { font-weight:bold; font-size:18px; }
.top-bar .right button { background:#007bff22; border:1px solid #007bff44; color:#fff; padding:6px 14px; border-radius:8px; cursor:pointer; }
.content { margin:120px auto 60px; width:900px; }
.calendar { background:#0d1b2a; border:1px solid #007bff44; border-radius:16px; padding:20px; }
.calendar-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.calendar-header button { background:#007bff22; border:1px solid #007bff44; color:#fff; padding:6px 12px; border-radius:8px; cursor:pointer; }
.calendar-header .month { font-size:18px; font-weight:bold; }
.weekdays { display:grid; grid-template-columns:repeat(7,1fr); text-align:center; opacity:0.7; margin-bottom:10px; }
.days { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
.day { height:100px; background: rgba(255,255,255,0.03); border-radius:10px; padding:4px; cursor:pointer; position:relative; display:flex; flex-direction:column; justify-content:center; align-items:center; }
.day.today { border:1px solid #007bff; }
.day .date { position:absolute; top:4px; right:4px; font-size:13px; opacity:0.8; }
.event { background:#007bff44; padding:2px 4px; margin:2px 0; border-radius:6px; font-size:12px; display:flex; justify-content:space-between; align-items:center; position:relative; }
.event .actions { display:flex; gap:2px; }
.event .actions button { background:transparent; border:none; cursor:pointer; width:16px; height:16px; padding:0; }
.event .actions button svg { fill:#fff; width:16px; height:16px; }
.empty-state { text-align:center; opacity:0.6; margin-top:30px; }
</style>
</head>
<body>

<div class="top-bar">
  <div class="center">Event & Calendar</div>
  <div class="right"><button onclick="goBack()">‚Üê Back</button></div>
</div>

<div class="content">
  <div class="calendar">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚Äπ</button>
      <div class="month" id="monthLabel"></div>
      <button onclick="changeMonth(1)">‚Ä∫</button>
    </div>
    <div class="weekdays">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="days" id="calendarDays"></div>
    <div class="empty-state" id="emptyState">No events scheduled</div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config (replace with your own)
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const role = localStorage.getItem("role") || "guest";
const username = localStorage.getItem("username") || "Staff";

function goBack(){ window.location.href='dashboard.html'; }

let currentDate = new Date();

function renderCalendar(eventsData={}){
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  document.getElementById("monthLabel").textContent = monthNames[month]+" "+year;
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1,0).getDate();
  const calendarDays = document.getElementById("calendarDays");
  calendarDays.innerHTML="";

  for(let i=0;i<firstDay;i++){
    const empty = document.createElement("div");
    empty.className="day empty";
    calendarDays.appendChild(empty);
  }

  let hasEvents=false;
  for(let d=1; d<=daysInMonth; d++){
    const dayDiv=document.createElement("div");
    dayDiv.className="day";
    const today=new Date();
    if(d===today.getDate() && month===today.getMonth() && year===today.getFullYear()) dayDiv.classList.add("today");
    const dateKey=`${year}-${month+1}-${d}`;
    dayDiv.innerHTML=`<div class="date">${d}</div>`;
    if(eventsData[dateKey]){
      hasEvents=true;
      eventsData[dateKey].forEach((ev,i)=>{
        const eventDiv=document.createElement("div");
        eventDiv.className="event";
        eventDiv.innerHTML=`<span>${ev.title}</span>
          ${(role==="admin"||role==="teacher")?`<div class="actions">
            <button onclick="editEvent(event,'${dateKey}',${i})">‚úèÔ∏è</button>
            <button onclick="deleteEvent(event,'${dateKey}',${i})">üóëÔ∏è</button>
          </div>`:""}`;
        dayDiv.appendChild(eventDiv);
      });
    }
    calendarDays.appendChild(dayDiv);
  }
  document.getElementById("emptyState").style.display = hasEvents ? "none" : "block";
}

function changeMonth(step){ currentDate.setMonth(currentDate.getMonth()+step); loadEvents(); }

function loadEvents(){
  db.ref("events").once("value").then(snapshot=>{
    const eventsData = snapshot.val() || {};
    renderCalendar(eventsData);
  });
}

function saveEvent(dateKey, eventsData){
  db.ref("events/"+dateKey).set(eventsData[dateKey]);
}

function addEvent(dateKey){
  const title = prompt("Event title:");
  if(!title) return;
  db.ref("events/"+dateKey).once("value").then(snapshot=>{
    const events = snapshot.val() || [];
    events.push({title});
    db.ref("events/"+dateKey).set(events).then(loadEvents);
  });
}

function editEvent(e,dateKey,index){
  e.stopPropagation();
  db.ref("events/"+dateKey).once("value").then(snapshot=>{
    const events = snapshot.val() || [];
    const title = prompt("Edit event title:", events[index].title);
    if(title) { events[index].title = title; db.ref("events/"+dateKey).set(events).then(loadEvents); }
  });
}

function deleteEvent(e,dateKey,index){
  e.stopPropagation();
  if(confirm("Delete this event?")){
    db.ref("events/"+dateKey).once("value").then(snapshot=>{
      const events = snapshot.val() || [];
      events.splice(index,1);
      db.ref("events/"+dateKey).set(events.length?events:null).then(loadEvents);
    });
  }
}

// Add new event on click (admin/teacher only)
if(role==="admin"||role==="teacher"){
  document.getElementById("calendarDays").addEventListener("click",function(ev){
    const dayDiv = ev.target.closest(".day");
    if(dayDiv && !dayDiv.classList.contains("empty")){
      const day = dayDiv.querySelector(".date").textContent;
      const month = currentDate.getMonth()+1;
      const year = currentDate.getFullYear();
      const dateKey=`${year}-${month}-${day}`;
      addEvent(dateKey);
    }
  });
}

// Initial load
loadEvents();
</script>

</body>
</html>
