<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event & Calendar</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#000;color:#fff;display:flex;flex-direction:column;height:100vh;}
.top-bar {display:flex;justify-content:space-between;align-items:center;background:rgba(10,15,30,0.9);padding:10px 20px;font-size:14px;}
.top-bar .center {font-weight:bold;font-size:18px;}
.top-bar .right button {background:#007bff22;border:1px solid #007bff44;color:#fff;padding:6px 14px;border-radius:8px;cursor:pointer;}
.content {margin:120px auto 60px;width:900px;}
.calendar {background:#0d1b2a;border:1px solid #007bff44;border-radius:16px;padding:20px;}
.calendar-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.calendar-header button {background:#007bff22;border:1px solid #007bff44;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;}
.calendar-header .month {font-size:18px;font-weight:bold;}
.weekdays {display:grid;grid-template-columns:repeat(7,1fr);text-align:center;opacity:0.7;margin-bottom:10px;}
.days {display:grid;grid-template-columns:repeat(7,1fr);gap:10px;}
.day {height:100px;background:rgba(255,255,255,0.03);border-radius:10px;padding:4px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;}
.day:hover {background:rgba(0,123,255,0.15);}
.day.today {border:1px solid #007bff;}
.day .date {font-size:13px;opacity:0.8;text-align:right;}
.event {background:#007bff44;padding:2px 4px;margin:2px 0;border-radius:6px;font-size:12px;display:flex;justify-content:space-between;align-items:center;}
.event span {overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.event .actions {display:flex;gap:4px;}
.event .actions button {background:transparent;border:none;color:#fff;cursor:pointer;font-size:12px;padding:0;}
.empty-state {text-align:center;opacity:0.6;margin-top:30px;}
</style>
</head>
<body>

<div class="top-bar">
  <div class="center">Event & Calendar</div>
  <div class="right"><button onclick="goBack()">‚Üê Back</button></div>
</div>

<div class="content">
  <div class="calendar">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚Äπ</button>
      <div class="month" id="monthLabel"></div>
      <button onclick="changeMonth(1)">‚Ä∫</button>
    </div>
    <div class="weekdays">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="days" id="calendarDays"></div>
    <div class="empty-state" id="emptyState">No events scheduled</div>
  </div>
</div>

<script>
function goBack(){window.location.href="dashboard.html";}

const role = localStorage.getItem("role") || "guest";
const username = localStorage.getItem("username") || "Staff";

let currentDate = new Date();
let events = JSON.parse(localStorage.getItem("calendarEvents") || "{}");

function saveEvents(){localStorage.setItem("calendarEvents", JSON.stringify(events));}

function renderCalendar(){
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
  document.getElementById("monthLabel").textContent=monthNames[month]+" "+year;

  const firstDay = new Date(year,month,1).getDay();
  const daysInMonth = new Date(year,month+1,0).getDate();
  const calendarDays=document.getElementById("calendarDays");
  calendarDays.innerHTML="";

  for(let i=0;i<firstDay;i++){
    const empty=document.createElement("div"); empty.className="day empty"; calendarDays.appendChild(empty);
  }

  let hasEvents=false;

  for(let d=1;d<=daysInMonth;d++){
    const day=document.createElement("div"); day.className="day";
    const today=new Date();
    if(d===today.getDate() && month===today.getMonth() && year===today.getFullYear()){day.classList.add("today");}

    const dateKey=`${year}-${month+1}-${d}`;
    day.innerHTML=`<div class="date">${d}</div>`;

    if(events[dateKey]){
      hasEvents=true;
      events[dateKey].forEach((ev,i)=>{
        const evDiv=document.createElement("div");
        evDiv.className="event";
        evDiv.innerHTML=`<span>${ev.title}</span>
        <div class="actions">
          ${role==="admin"?'<button onclick="editEvent(event, \''+dateKey+'\','+i+')">‚úé</button><button onclick="deleteEvent(event, \''+dateKey+'\','+i+')">üóë</button>':""}
        </div>`;
        day.appendChild(evDiv);
      });
    }

    if(role==="admin"){
      day.onclick=(e)=>{if(e.target.closest(".actions")) return; addEvent(dateKey);}
    }

    calendarDays.appendChild(day);
  }

  document.getElementById("emptyState").style.display=hasEvents?"none":"block";
}

function changeMonth(step){currentDate.setMonth(currentDate.getMonth()+step);renderCalendar();}

function addEvent(dateKey){
  const title=prompt("Event title:");
  if(!title) return;
  if(!events[dateKey]) events[dateKey]=[];
  events[dateKey].push({title,creator:username,date:new Date().toLocaleString()});
  saveEvents();
  renderCalendar();
}

function editEvent(e,dateKey,index){
  e.stopPropagation();
  const newTitle=prompt("Edit event title:",events[dateKey][index].title);
  if(newTitle){events[dateKey][index].title=newTitle;saveEvents();renderCalendar();}
}

function deleteEvent(e,dateKey,index){
  e.stopPropagation();
  if(confirm("Delete this event?")){events[dateKey].splice(index,1);if(events[dateKey].length===0) delete events[dateKey]; saveEvents(); renderCalendar();}
}

renderCalendar();
</script>
</body>
</html>
